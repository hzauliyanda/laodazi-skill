# 百家号文章发布工具

一键将 Markdown 文章发布到百度百家号平台。

## 核心功能

- 📝 **自动解析 Markdown**：提取标题、摘要、封面图、正文和图片
- 🖼️ **智能图片处理**：自动下载远程图片并上传到百家号
- 💾 **草稿保存**：默认保存为草稿，可随时编辑
- 🚀 **直接发布**：可选直接发布到百家号
- 🔄 **登录状态保持**：使用浏览器保存的登录状态

## 快速开始

### 1. 准备文章

创建 Markdown 文件（可选 frontmatter）：

```markdown
---
title: 赵匡胤究竟是怎样一个人？
cover_image: /path/to/cover.jpg
tags: 历史,人物传记
author: 老达子
summary: 揭秘历史上真实的赵匡胤
---

# 前言
很多人提起大宋开国皇帝赵匡胤...

![图片描述](./image1.png)

更多内容...
```

### 2. 登录百家号（首次使用）

在浏览器中登录百家号：
- 访问：https://baijiahao.baidu.com/builder/rc/home
- 完成登录验证

### 3. 发布文章

```bash
# 保存为草稿（默认）
/laodazi-post-to-baijiahao article.md

# 直接发布
/laodazi-post-to-baijiahao article.md --submit
```

## Frontmatter 格式

| 字段 | 必填 | 说明 |
|------|------|------|
| `title` | 否* | 文章标题（默认使用第一个 H1 或文件名） |
| `cover_image` | 否 | 封面图路径（本地或远程 URL） |
| `tags` | 否 | 逗号分隔的标签 |
| `author` | 否 | 作者名称 |
| `summary` | 否 | 文章摘要/描述 |

*建议在 frontmatter 中提供标题，确保跨平台一致性

## 命令选项

| 选项 | 说明 |
|------|------|
| `--submit` | 直接发布（默认：保存草稿） |
| `--profile <path>` | 自定义 Chrome 配置目录 |

## 平台限制

### 百家号

- **登录地址**: https://baijiahao.baidu.com/builder/rc/home
- **图片限制**: JPG/PNG，单张图片 ≤ 2MB
- **封面图**: 支持通过专门的上传区域上传

## 工作原理

1. **解析 Markdown**：提取标题、摘要、封面图和正文图片
2. **浏览器自动化**：启动 Chrome 并使用保存的登录会话
3. **内容插入**：
   - 输入文章标题
   - 插入文章内容
   - 通过剪贴板上传图片
4. **提交发布**：创建草稿或直接发布

## 故障排查

### "未登录" 错误

确保您已在浏览器中登录百家号。此工具使用 Chrome 的用户数据目录来保留登录会话。

### 图片上传失败

1. 检查图片格式是否支持（JPG、PNG、GIF、WebP）
2. 确保图片文件未损坏
3. 检查图片大小是否超过 2MB

### 浏览器未找到

设置 `BAIJIAHAO_BROWSER_CHROME_PATH` 环境变量为 Chrome 可执行文件路径。

### 剪贴板问题

此工具使用系统剪贴板上传图片，请确保：
- 没有其他应用程序干扰剪贴板
- 已授予必要的权限

## 图片处理

- **本地图片**：相对于 Markdown 文件位置解析
- **远程图片**：自动下载到临时目录
- **图片占位符**：发布期间通过剪贴板插入

## 配置环境变量

| 变量 | 说明 |
|------|------|
| `BAIJIAHAO_BROWSER_CHROME_PATH` | Chrome 可执行文件路径 |
| `BAIJIAHAO_PROFILE_DIR` | 自定义配置文件目录 |

## 错误处理

- 详细的错误消息用于调试
- 瞬态故障的重试机制
- 失败时自动清理临时文件
